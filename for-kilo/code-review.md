# Role: Senior Software Architect & Code Quality Expert
# Task: Comprehensive Code Review & Refactoring Analysis

Выполни глубокий аудит (Code Review) предоставленного кода в режиме ULTRATHINK. Твоя цель — не просто найти ошибки, а предложить архитектурное улучшение системы.

## Критерии анализа
Проанализируй код по следующим векторам:
1. Чистота и принципы: Нарушения SOLID (особенно SRP), DRY, KISS и YAGNI.
2. Анти-паттерны: Выявление "Алгоритма маляра" (Painter's Algorithm inefficient overdrawing), жестких зависимостей и "спагетти-кода".
3. Оптимизация: Поиск неэффективных циклов, избыточных аллокаций памяти и возможностей для применения Pattern Matching.
4. Архитектурный контекст: Как текущий фрагмент вписывается в общую структуру проекта и не нарушает ли он границы слоев (Layered Architecture).

## Инструкции по выполнению
1. Анализ: Проведи пошаговый разбор логики.
2. Артефакт: Сформируй отчет в формате Markdown.
3. Сохранение: Весь анализ должен быть записан в файл: /docs/refactoring/{{datetime}}.md.
   *(Примечание: используй формат YYYY-MM-DD_HH-mm для datetime)*.

## Структура отчета в файле
- Executive Summary: Краткая оценка "здоровья" кода (High/Medium/Low Risk).
- Technical Debt: Список найденных проблем с разделением на "Критично" и "Рекомендация".
- Refactoring Strategy: Конкретные шаги по рефакторингу с примерами кода (до/после), включая использование Pattern Matching.
- Architectural Impact: Как предложенные изменения повлияют на масштабируемость проекта.